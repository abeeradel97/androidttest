define(["require","exports","tslib","react","external/prop-types","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar","modules/clean/avatar/style","modules/clean/avatar/viewer_avatar","modules/clean/em_string","modules/clean/react/pass/constants","modules/clean/react/pass/utils","modules/core/browser_detection","modules/core/user_i18n","modules/core/i18n","deep-integrations/platform/server/localization","modules/clean/react/pass/integration/profile_card_popover","external/react-redux","modules/clean/integrations/app_store_lite_modal","modules/clean/integrations/link_service","deep-integrations/profile_card/profile_card_tooltip_content","modules/clean/react/pass/tooltip_helpers","modules/clean/integrations/data/actions","deep-integrations/data/user_settings","modules/clean/integrations/profile_card_tooltip","modules/clean/integrations/data/store","modules/clean/integrations/data/selectors","deep-integrations/async","spectrum/avatar"],function(e,t,o,r,n,a,i,s,l,p,c,u,d,f,v,m,h,g,_,C,I,E,y,A,S,T,P,x,w){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=o.__importDefault(r),n=o.__importStar(n),a=o.__importDefault(a),l=o.__importDefault(l),d=o.__importStar(d),f=o.__importStar(f);var N=(function(e){function t(t,o){var n=e.call(this,t,o)||this;return n.renderAvatarButton=function(){return r.default.createElement("button",{className:"pass-facepile-avatar"},n.getAvatar())},n.state={loadResult:"loaded"},n.onAvatarClick=n.onAvatarClick.bind(n),n}return o.__extends(t,e),t.prototype.onAvatarClick=function(){this.props.logPassEvent(c.EventTypes.PASS_CLICK)},t.prototype.render=function(){var e=this.wrapAvatarWithTooltip(),t="pending"===this.state.loadResult?"react-pass__face-no-display":"react-pass__face-container";return r.default.createElement("div",{className:t},e)},t.prototype.wrapAvatarWithTooltip=function(){var e=this.context.getPopoverGroup(),t=this.props.tooltipCanInitiallyOpen&&this.context.shouldAutoDisplayTooltip();return r.default.createElement(e.popover,{upsellContent:this.getTooltipElement(),profileCard:this.getProfileCardElement(),positioning:"below",positionOffset:9,onClickTrigger:this.onAvatarClick,onMouseOverTrigger:this.props.onMouseEnter,isShowInitially:t},r.default.createElement("div",{className:"react-title-bubble__container"},this.renderAvatarButton()))},t.contextTypes={getPopoverGroup:n.func,shouldAutoDisplayTooltip:n.func},t})(r.default.Component),O=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.colorSeed,o=e.integrationStore,n=e.userInfo,a=e.userInfo.displayName,i=p.Emstring.em_snippet(a,10);return r.default.createElement(g.Provider,{store:o},r.default.createElement("div",{className:"rich-facepile-tooltip-content--passive"},r.default.createElement(S.StatefulProfileCardTooltipContent,{displayName:i,seenState:E.buildSeenStateMessage(n),avatarColor:w.avatarColorForUserIdentifier(t),localization:m.localization})))},t})(r.default.Component);t.UserAvatarPassiveTooltipContent=O;var M=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.connectService=function(e){var o=t.props,r=o.integrationStore,n=o.integrationInfo.userId,a=P.isConnectServiceLandingPagesEnabled(r.getState());return C.linkService(n,e,a).then(function(){(0,r.dispatch)(y.fetchListServices())})},t.showAppStoreLiteModal=function(){window.dispatchEvent(new Event("resize")),_.showAppStoreLiteModal(t.props.integrationInfo.userId)},t}return o.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.colorSeed,o=e.integrationInfo,n=o.fileId,a=o.fileName,i=e.integrationStore,s=e.logEvent,l=e.performanceTimer,p=e.reportError,c=e.userInfo;return r.default.createElement(g.Provider,{store:i},r.default.createElement("div",{className:"rich-facepile-tooltip-content--active"},r.default.createElement(h.ProfileCardPopover,{userInfo:c,fileInfo:{".tag":"file",id:x.fulfilled(n),name:a},avatarColor:w.avatarColorForUserIdentifier(t),onConnectService:this.connectService,onConnectServices:this.showAppStoreLiteModal,logEvent:s,entryPoint:"file_preview",performanceTimer:l,reportError:p})))},t})(r.default.Component);t.UserAvatarActiveTooltipContent=M;var L=(function(e){function t(t,o){var r=e.call(this,t,o)||this;return r.showAppStoreLiteModal=function(){r.context.getPopoverGroup().closePortal(),_.showAppStoreLiteModal(r.props.integrationInfo.userId)},r.connectService=function(e){r.context.getPopoverGroup().closePortal();var t=P.isConnectServiceLandingPagesEnabled(r.context.getIntegrationStore().getState());return C.linkService(r.props.integrationInfo.userId,e,t).then(function(){r.context.getIntegrationStore().dispatch(y.fetchListServices())})},r.state={loadResult:null==r.props.userInfo.photoUrl?"loaded":"pending"},r.boundOnLoad=r.onFinalize.bind(r,!0),r.boundOnError=r.onFinalize.bind(r,!1),r}return o.__extends(t,e),t.prototype.isGuestAvatar=function(){return this.props.userInfo.userId&&u.AnonymousViewerUtils.isAnonymousUserId(this.props.userInfo.userId)},t.prototype.getUserAvatarProps=function(){var e=this.props.userInfo,t=e.displayName,n=e.isActive,a=this.isGuestAvatar()?u.AnonymousViewerUtils.getAnonymousViewerInitials(t):f.getInitials(t),s={dimension:32,initials:a,color:this.getInitialsColor(),shape:"CIRCLE"};n||(s.optionalClass="c-avatar--inactive",d.msie&&(s.color="#7B8994"));var l=r.default.createElement(i.InitialsAvatar,o.__assign({},s));return n||(l=r.default.createElement("span",{className:"c-avatar-initials-wrapper"},l)),{alt:t,dimension:32,photoUrl:this.getEffectivePhotoUrl(),defaultAvatar:l,optionalClass:s.optionalClass,shape:"CIRCLE",onLoad:this.boundOnLoad,onError:this.boundOnError}},t.prototype.getEffectivePhotoUrl=function(){return"error"===this.state.loadResult?void 0:this.props.userInfo.photoUrl},t.prototype.getAvatar=function(){var e=this.getUserAvatarProps();return this.props.userInfo.isViewer&&"error"!==this.state.loadResult?r.default.createElement(l.default,o.__assign({},e)):r.default.createElement(a.default,o.__assign({},e))},t.prototype.onAvatarClick=function(){e.prototype.onAvatarClick.call(this);var t=this.context.getIntegrationStore(),o=["tooltip_click_for_more","tooltip_click_for_more_auto_display"].filter(function(e){return!T.isPromptDismissed(t.getState(),e)}).map(function(e){return{".tag":e}});o.length>0&&t.dispatch(A.dismissPrompts(o))},t.prototype.onFinalize=function(e){if(null!=this.getEffectivePhotoUrl()){this.setState({loadResult:e?"loaded":"error"});var t=this.props,o=t.userInfo.photoUrl,r=t.onLoad;r&&o&&r(o)}},t.prototype.getInitialsColor=function(){return this.isGuestAvatar()?s.colorValueForAvatarName(this.props.userInfo.userId):s.colorValueForAvatarName(this.props.userInfo.displayName)},t.prototype.getTooltipElement=function(){var e=this.props.userInfo,t=p.Emstring.em_snippet(e.displayName,10);return r.default.createElement(g.Provider,{store:this.context.getIntegrationStore()},r.default.createElement(S.StatefulProfileCardTooltipContent,{displayName:t,seenState:E.buildSeenStateMessage(e),avatarColor:this.getInitialsColor(),localization:m.localization}))},t.prototype.getProfileCardElement=function(){var e=this.props,t=e.userInfo,o=e.integrationInfo;return r.default.createElement(g.Provider,{store:this.context.getIntegrationStore()},r.default.createElement(h.ProfileCardPopover,{userInfo:t,fileInfo:{".tag":"file",id:x.fulfilled(o.fileId),name:o.fileName},avatarColor:this.getInitialsColor(),onConnectService:this.connectService,onConnectServices:this.showAppStoreLiteModal,logEvent:this.context.logEvent(),entryPoint:"file_preview",performanceTimer:this.context.performanceTimer(),reportError:this.context.reportError()}))},t.contextTypes={getApiV2Client:n.func,getDataStore:n.func,getIntegrationStore:n.func,getPopoverGroup:n.func,shouldAutoDisplayTooltip:n.func,performanceTimer:n.func,logEvent:n.func,reportError:n.func},t})(N);t.UserAvatar=L;var U=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o.__extends(t,e),t.prototype.getTooltipMessage=function(){return v.ungettext("%(display_num)s other","%(display_num)s others",this.getDisplayNum()).format({display_num:this.getMoreFacepileCountText()})},t.prototype.getDisplayNum=function(){return this.props.moreFacepileCount>=c.MAX_OVERFLOW_BUTTON_INDICATOR?c.MAX_OVERFLOW_BUTTON_INDICATOR:this.props.moreFacepileCount},t.prototype.getMoreFacepileCountText=function(){return this.props.moreFacepileCount>=c.MAX_OVERFLOW_BUTTON_INDICATOR?c.MAX_OVERFLOW_BUTTON_INDICATOR+"+":""+this.props.moreFacepileCount},t.prototype.getAvatar=function(){return r.default.createElement(i.InitialsAvatar,{alt:this.getMoreFacepileCountText(),dimension:32,initials:this.getMoreFacepileCountText(),color:"#7B8994",shape:"CIRCLE",optionalClass:"c-avatar--overflow"})},t.prototype.onAvatarClick=function(){e.prototype.onAvatarClick.call(this),this.props.openShareModal()},t.prototype.getTooltipElement=function(){return r.default.createElement(I.OverflowTooltipContent,{overflowMessage:this.getTooltipMessage()})},t.prototype.getProfileCardElement=function(){return null},t})(N);t.OverflowAvatar=U});
//# sourceMappingURL=avatars.min.js-vflAa-mfD.map