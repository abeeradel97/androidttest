define(["require","exports","tslib","spectrum_comments/comment_editor/core/class_decorators","spectrum_comments/comment_editor/layers/scaffold","spectrum_comments/comment_editor/core/types","draft-js"],function(t,e,r,o,n,a,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(e,t),e.prototype.initStyle=function(t){var e=t.innerProps.evt,r=this.splitStickers(e.metadata).stickers;if(r.length){var o=r[0],n=i.ContentState.createFromText("").createEntity("sticker","IMMUTABLE",o),a=n.getLastCreatedEntityKey(),c=i.AtomicBlockUtils.insertAtomicBlock(i.EditorState.createWithContent(n),a,"*"),s=c.getCurrentContent().getBlockMap().skip(1).first(),p=i.ContentState.createFromBlockArray([s]);return i.EditorState.createWithContent(p)}},e.prototype.postStyles=function(t){var e=t.innerProps,o=e.evt,n=e.value,a=this.getStickerMetadata(i.convertToRaw(o.getCurrentContent())),c=this.splitStickers(n.metadata).other;return r.__assign({},n,{metadata:c.concat(a)})},e.prototype.getStickerMetadata=function(t){var e=t.blocks,o=e.reduce(function(e,o){var n=e.metadata,a=e.pos,i=o.entityRanges;return{metadata:n.concat(i.filter(function(e){return"sticker"===t.entityMap[e.key].type}).map(function(e){var o=t.entityMap[e.key].data;return r.__assign({type:"sticker"},o.metadata[0])})),pos:a+o.text.length}},{metadata:[],pos:0}),n=o.metadata;o.pos;return n},e.prototype.splitStickers=function(t){return t.reduce(function(t,e){return"sticker"===e.type?{stickers:t.stickers.concat([e]),other:t.other}:{stickers:t.stickers,other:t.other.concat([e])}},{stickers:[],other:[]})},r.__decorate([o.plug(n.into.draft.on.populateWithComment.update.editorState)],e.prototype,"initStyle",null),r.__decorate([o.plug(n.into.comment.on.post.update.content)],e.prototype,"postStyles",null),e})(a.BaseLayer);e.StickerLayer=c});
//# sourceMappingURL=stickers.min.js-vfllxGWHS.map